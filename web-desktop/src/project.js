require=function t(e,i,o){function s(c,l){if(!i[c]){if(!e[c]){var r="function"==typeof require&&require;if(!l&&r)return r(c,!0);if(n)return n(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var a=i[c]={exports:{}};e[c][0].call(a.exports,function(t){var i=e[c][1][t];return s(i?i:t)},a,a.exports,t,e,i,o)}return i[c].exports}for(var n="function"==typeof require&&require,c=0;c<o.length;c++)s(o[c]);return s}({Game:[function(t,e,i){"use strict";cc._RFpush(e,"1e46aM2dhhK3oHWbLOuQkNx","Game"),cc.Class({"extends":cc.Component,properties:{tilesController:t("TilesController")},onLoad:function(){this.tilesController.init(this)}}),cc._RFpop()},{TilesController:"TilesController"}],TilesController:[function(t,e,i){"use strict";cc._RFpush(e,"8202aSYV1FKgIM/exL9k/c2","TilesController");var o=cc.Enum({UP:-1,DOWN:-1,LEFT:-1,RIGHT:-1}),s=cc.Enum({PLAYING:-1,WIN:-1});cc.Class({"extends":cc.Component,properties:{gameState:{type:s,"default":s.PLAYING},score:0,scoreLabel:cc.Label,tiles:[],tilesLayout:cc.Node,tilePrefab:cc.Prefab,rowNum:0,colNum:0,padding:0,spacing:0},init:function(t){this.game=t,this.scoreLabel.string=this.score+"",this.gameState=s.PLAYING,this.tileWidth=(this.tilesLayout.width-2*this.padding-this.spacing*(this.colNum-1))/this.colNum;for(var e=0;e<this.rowNum;e++)for(var i=0;i<this.colNum;i++){var o=cc.instantiate(this.tilePrefab);this.tilesLayout.addChild(o),o.width=this.tileWidth,o.height=this.tileWidth,o.position=cc.p(this.padding+i*(this.tileWidth+this.spacing),this.padding+e*(this.tileWidth+this.spacing)),o.getComponent("Tile").posIndex=o.position,o.tag=e*this.colNum+i,this.addTouchEvent(o),this.tiles.push(o)}this.touchAble=!1,this.deleteTiles()},addTouchEvent:function(t){var e,i,n,c=this,l=function(){n=Math.abs(i.x-e.x)>Math.abs(i.y-e.y)?i.x>e.x?o.RIGHT:o.LEFT:i.y>e.y?o.UP:o.DOWN,c.gameState===s.PLAYING&&c.touchAble&&(c.touchAble=!1,c.tryExchange(t,n))};t.on("touchstart",function(t){e=t.getLocation()},this),t.on("touchmove",function(t){},this),t.on("touchend",function(t){i=t.getLocation(),l()},this),t.on("touchcancel",function(t){i=t.getLocation(),l()},this)},tryExchange:function(t,e){var i=this,o=this.getNeighborTile(t,e);if(null!==o){this.exchangeTwoTilesState(t,o);var s=this.getHorizontalLines(),n=this.getVerticalLines();if(s.length+n.length>0)!function(){i.exchangeTwoTilesPosIndex(t,o);var e=0,s=2,n=i,c=cc.sequence(cc.moveTo(.15,t.getComponent("Tile").posIndex),cc.callFunc(function(){e++,e==s&&n.deleteTiles()})),l=cc.sequence(cc.moveTo(.15,o.getComponent("Tile").posIndex),cc.callFunc(function(){e++,e==s&&n.deleteTiles()}));t.runAction(c),o.runAction(l)}();else{this.exchangeTwoTilesState(t,o);var c=0,l=2,r=this,h=t.position,a=o.position,u=cc.sequence(cc.moveTo(.1,a),cc.moveTo(.1,h),cc.callFunc(function(){c++,c==l&&(r.touchAble=!0)})),p=cc.sequence(cc.moveTo(.1,h),cc.moveTo(.1,a),cc.callFunc(function(){c++,c==l&&(r.touchAble=!0)}));t.runAction(u),o.runAction(p)}}},exchangeTwoTilesState:function(t,e){this.tiles[t.tag]=e,this.tiles[e.tag]=t;var i=t.tag;t.tag=e.tag,e.tag=i},exchangeTwoTilesPosIndex:function(t,e){var i=t.getComponent("Tile").posIndex,o=e.getComponent("Tile").posIndex;t.getComponent("Tile").posIndex=o,e.getComponent("Tile").posIndex=i},deleteTiles:function(){var t=this,e=this.getHorizontalLines(),i=this.getVerticalLines();if(e.length+i.length===0)return void(this.touchAble=!0);var o=0,n=0,c=[];for(var l in e)o+=e[l].getComponent("Tile").type,c.push(e[l]);for(var l in i){n+=i[l].getComponent("Tile").type;var r=!1;for(var h in e)e[h]===i[l]&&(r=!0);r||c.push(i[l])}this.score+=o-n,47===this.score?(this.gameState=s.WIN,this.scoreLabel.string="YOU GET 47!"):this.scoreLabel.string=this.score+"";for(var a=0,u=c.length,l=0;l<u;l++){var p=cc.sequence(cc.scaleTo(.15,0,0),cc.callFunc(function(){a++,a==u&&t.fallTiles()}));c[l].getComponent("Tile").isAlive=!1,c[l].runAction(p)}},fallTiles:function(){for(var t=this,e=!1;!e;){e=!0;for(var i=1;i<this.rowNum;i++)for(var o=0;o<this.rowNum;o++)this.tiles[i*this.colNum+o].getComponent("Tile").isAlive&&!this.tiles[(i-1)*this.colNum+o].getComponent("Tile").isAlive&&(this.exchangeTwoTilesState(this.tiles[i*this.colNum+o],this.tiles[(i-1)*this.colNum+o]),this.exchangeTwoTilesPosIndex(this.tiles[i*this.colNum+o],this.tiles[(i-1)*this.colNum+o]),e=!1)}var s=[];for(var n in this.tiles)this.tiles[n].getComponent("Tile").posIndex!==this.tiles[n].position&&s.push(this.tiles[n]);for(var c=0,l=s.length,n=0;n<l;n++){var r=cc.sequence(cc.moveTo(.3,s[n].getComponent("Tile").posIndex),cc.callFunc(function(){c++,c==l&&t.addTiles()}));s[n].runAction(r)}},addTiles:function(){for(var t=this,e=[],i=0;i<this.rowNum;i++)for(var o=0;o<this.rowNum;o++)this.tiles[i*this.colNum+o].getComponent("Tile").isAlive||e.push(this.tiles[i*this.colNum+o]);for(var s=0,n=e.length,c=0;c<n;c++){var l=cc.sequence(cc.scaleTo(.15,1,1),cc.callFunc(function(){s++,s==n&&t.deleteTiles()}));e[c].getComponent("Tile").initType(),e[c].getComponent("Tile").isAlive=!0,e[c].runAction(l)}},getVerticalLines:function(){for(var t=[],e=1,i=0;i<this.colNum;i++)for(var o=0;o<this.rowNum-2;o+=e){var s=this.tiles[o*this.colNum+i],n=s.getComponent("Tile").type;e=1;for(var c=o+1;c<this.rowNum&&this.tiles[c*this.colNum+i].getComponent("Tile").type===n;c++)e++;if(e>=3)for(var l=0;l<e;l++)t.push(this.tiles[(o+l)*this.colNum+i])}return t},getHorizontalLines:function(){for(var t=[],e=1,i=0;i<this.rowNum;i++)for(var o=0;o<this.colNum-2;o+=e){var s=this.tiles[i*this.colNum+o],n=s.getComponent("Tile").type;e=1;for(var c=o+1;c<this.colNum&&this.tiles[i*this.colNum+c].getComponent("Tile").type===n;c++)e++;if(e>=3)for(var l=0;l<e;l++)t.push(this.tiles[i*this.colNum+o+l])}return t},getNeighborTile:function(t,e){var i=t.tag%this.colNum,s=(t.tag-i)/this.rowNum;switch(e){case o.LEFT:return 0===i?null:this.tiles[s*this.colNum+(i-1)];case o.RIGHT:return i===this.colNum-1?null:this.tiles[s*this.colNum+(i+1)];case o.UP:return s===this.rowNum-1?null:this.tiles[(s+1)*this.colNum+i];case o.DOWN:return 0===s?null:this.tiles[(s-1)*this.colNum+i]}},newView:function(){if(this.gameState==s.PLAYING&&1==this.touchAble){var t=this;this.touchAble=!1;for(var e=0,i=this.tiles.length,o=0;o<i;o++){var n=cc.sequence(cc.scaleTo(.3,0,0),cc.callFunc(function(){e++,e==i&&t.addTiles()}));this.tiles[o].getComponent("Tile").isAlive=!1,this.tiles[o].runAction(n)}}}}),cc._RFpop()},{}],Tile:[function(t,e,i){"use strict";cc._RFpush(e,"6c41adWBH9ArJwcnWjSTGK1","Tile"),cc.Class({"extends":cc.Component,properties:{pics:{type:cc.SpriteFrame,"default":[]},_type:1,posIndex:cc.Vec,type:{set:function(t){this._type=t,this.node.getComponent(cc.Sprite).spriteFrame=this.pics[t-1]},get:function(){return this._type}},isAlive:!0},onLoad:function(){this.initType()},initType:function(){this.type=Math.floor(Math.random()*this.pics.length)+1}}),cc._RFpop()},{}]},{},["Game","Tile","TilesController"]);